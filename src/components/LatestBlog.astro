---
import { getCollection } from 'astro:content';

const allDocs = await getCollection('docs');
const blogPosts = allDocs
  .filter(doc => doc.id && doc.id.startsWith('blog/') && !doc.id.includes('index'))
  .sort((a, b) => {
    const aDate = a.data?.date ? new Date(a.data.date).getTime() : 0;
    const bDate = b.data?.date ? new Date(b.data.date).getTime() : 0;
    return bDate - aDate;
  });

let recentPosts = blogPosts.slice(0, 3).map(post => {
  const dDate = post.data?.date;
  const dateStr = dDate ? new Date(dDate).toISOString().split('T')[0] : 'Recent';
  return {
    title: post.data?.title || 'SEOCHO Update',
    excerpt: post.data?.excerpt || post.data?.description || 'Discover the latest releases and updates from the SEOCHO engineering team.',
    date: dateStr,
    url: `/blog/${post.slug.replace('blog/', '')}/`
  };
});

// Pad placeholders if there are fewer than 3 blog posts available yet
while (recentPosts.length < 3) {
  recentPosts.push({
    title: 'Future Release Update',
    excerpt: 'Stay tuned for upcoming architectural features, routing mechanisms, and performance improvements.',
    date: 'Coming Soon',
    url: '/blog/'
  });
}

const featured = recentPosts[0];
const others = recentPosts.slice(1, 3);
---

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-8 relative z-10 w-full font-sans">
  
  {/* Featured Main Card - Larger footprint */}
  <a href={featured.url} class="group relative flex flex-col justify-end bg-black border border-white/10 rounded-2xl overflow-hidden p-8 sm:p-10 hover:border-white/20 transition-all duration-300 min-h-[380px] shadow-2xl">
    <div class="absolute inset-0 bg-gradient-to-t from-[#040404] via-[#040404]/80 to-transparent z-10"></div>
    {/* Subtle aesthetic glow matching Letta */}
    <div class="absolute top-0 right-0 w-64 h-64 bg-zinc-600/10 blur-[80px] rounded-full pointer-events-none z-0"></div>
    
    <div class="relative z-20 mt-auto flex flex-col h-full justify-between">
      <div class="flex items-center gap-3 text-xs font-mono text-zinc-500 mb-auto">
        <span class="bg-white text-black px-2.5 py-1 rounded font-bold uppercase tracking-widest text-[10px]">Latest</span>
        <span class="text-white/50">{featured.date}</span>
      </div>
      <div>
        <h3 class="text-3xl font-bold text-white mb-4 group-hover:text-zinc-300 transition-colors leading-tight mt-12">{featured.title}</h3>
        <p class="text-zinc-400 text-base font-light line-clamp-3 leading-relaxed">{featured.excerpt}</p>
      </div>
    </div>
  </a>

  {/* Secondary Cards Column */}
  <div class="flex flex-col gap-6">
    {others.map(post => (
      <a href={post.url} class="group flex-1 flex flex-col justify-center bg-[#040404] border border-white/10 rounded-2xl overflow-hidden p-8 hover:border-white/20 transition-all duration-300 shadow-2xl relative">
        <div class="absolute inset-0 bg-gradient-to-b from-white/[0.02] to-transparent pointer-events-none"></div>
        <div class="relative z-10">
          <div class="flex items-center gap-3 text-xs font-mono text-zinc-500 mb-4">
            <span class="text-white/30">{post.date}</span>
          </div>
          <h3 class="text-xl font-bold text-white mb-3 group-hover:text-zinc-300 transition-colors leading-snug">{post.title}</h3>
          <p class="text-zinc-400 text-sm font-light line-clamp-2 leading-relaxed">{post.excerpt}</p>
        </div>
      </a>
    ))}
  </div>
</div>
